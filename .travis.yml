language: go
branches:
  except:
  - /^scrum\d+$/
go:
  - 1.8
env:
  global:
    - APP_ENV=test
    - APP_CONF_PATH=../conf
services:
  - redis-server
  - postgresql
addons:
  postgresql: "9.5"
before_install:
  - export PATH=$PATH:$HOME/gopath/bin
  - echo -e "machine github.com\n  login b08b064f7d82cfb3996562e74e125160e076f6be" >> ~/.netrc
  - psql -c 'ALTER USER postgres WITH SUPERUSER'
  - psql -U postgres -c 'CREATE DATABASE {|PROJECTNAME|}_test;'
  - psql -U postgres -c "CREATE EXTENSION postgis;" {|PROJECTNAME|}_test
  - go get bitbucket.org/liamstask/goose/cmd/goose
  - goose -path=conf -env=test up
install:
  - go get github.com/Masterminds/glide
  - glide install
script:
  - go test -v -cover $(go list ./... | grep -v /vendor/)
  - curl -s https://b08b064f7d82cfb3996562e74e125160e076f6be@raw.githubusercontent.com/gtforge/gett_tools_scripts/master/code_analysis/golang/travis-check/static_analysis_tools.sh | bash
